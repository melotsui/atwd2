<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>ATWD - Market</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- JQuery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

  <!-- Favicons -->
  <link href="./assets/img/favicon.png" rel="icon">
  <link href="./assets/img/apple-touch-icon.png" rel="apple-touch-icon">
        
  <!-- Google Fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="./assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="./assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="./assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="./assets/vendor/quill/quill.snow.css" rel="stylesheet">
  <link href="./assets/vendor/quill/quill.bubble.css" rel="stylesheet">
  <link href="./assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="./assets/vendor/simple-datatables/style.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="./assets/css/style.css" rel="stylesheet">
</head>
<body >

  <!-- ======= Header ======= -->
      <app-root></app-root>
  <!-- ======= Sidebar ======= -->
        
  <!-- ======= Main ======= -->

<script>
  function clickRegionAddIcon(){
    // console.log(regionList);
    
  }
</script>
  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>


<!-- modal for confirmation of delete operation-->
  


  <script src="assets/js/marketList.js"></script>
  <script src="assets/js/pageLoad.js"></script>
  <script type="text/javascript">
    
    // var path = location.protocol + "//" + location.hostname + ":" + location.port;
    var path = "http://127.0.0.1:8080";
console.log(path);
    $(function(){
      pageLoad();
      marketList('');
    });
    
    var req = new XMLHttpRequest();
    var req1 = new XMLHttpRequest();
    var tc = '';
    var doAction = '';

    function getMarketByID(mID){
      var url = path + '/atwd/index.php/market/mID/' + mID;
      var body = null;
      req.open("GET", url, true);
      // console.log('getMarketByID');
      // console.log(url);
      req.onreadystatechange = queryMarket;
      req.send(body);
    }

    function queryMarket(){
      if (req.readyState == 4) {
        if (req.status == 200) {
          var serverData = req.responseText;
          var rs = JSON.parse(serverData);
          document.getElementById('modalMarketID').style.display = 'block';
          document.getElementById('modalMarketID').value = rs['Data']['Market_ID'];
          document.getElementById('modalName_e').value = rs['Data']['Market_Name_e']; 
          document.getElementById('modalName_c').value = rs['Data']['Market_Name_c']; 
          var regionHtml = '<option value="" selected></option>';
          for(region of regionList){
            var selected = '';
            if(rs['Data']['Region_e'] == region['region_e']){
              selected = 'selected';
            }
            regionHtml += '<option value="'+region['region_e']+'" '+selected+'>'+region['region_e']+'</option>'
          }
          document.getElementById("modalRegion_e").innerHTML = regionHtml;
          document.getElementById('modalRegion_c').value = rs['Data']['Region_c']; 
          document.getElementById('modalDistrict_e').value = rs['Data']['District_e']; 
          document.getElementById('modalDistrict_c').value = rs['Data']['District_c']; 
          document.getElementById('modalAddress_e').value = rs['Data']['Address_e']; 
          document.getElementById('modalAddress_c').value = rs['Data']['Address_c']; 
          document.getElementById('modalBH_e').value = rs['Data']['Bussiness_Hour_e']; 
          document.getElementById('modalBH_c').value = rs['Data']['Bussiness_Hour_c']; 
          document.getElementById('modalContact1').value = rs['Data']['Contact_1']; 
          document.getElementById('modalContact2').value = rs['Data']['Contact_2']; 
          document.getElementById('modalCoordinate').value = rs['Data']['Coordinate']; 
          document.getElementById('map-container-google-2').innerHTML = '<iframe src="https://maps.google.com/maps?q='+rs['Data']['Coordinate']+'&t=&z=13&ie=UTF8&iwloc=&output=embed" frameborder="0"style="border:0;width:100%;" allowfullscreen ></iframe>'; 
          tc = '<table class="table table-striped">';
          tc += '<thead>';
          tc += '<th scope="col"></th>';
          tc += '<th scope="col">Tenancy Commodity</th>';
          tc += '<th scope="col"></th>';
          tc += '<th scope="col">Nos Stall</th></thead><tbody>';
          
          for(var i=0; i< rs['Data']['Tenancy_Commodity'].length; i++){
            tc += '<tr>';
            tc += '<td><input class="form-check-input modal-tc" type="checkbox" id="modalCheckBoxTC_e" value="'+rs['Data']['Tenancy_Commodity'][i]['Tenancy_Commodity_e']+'" checked disabled></td>';
            tc += '<td><label class="form-check-label" for="modalCheckBoxTC_e"><input class="tcModal-e" type="text" style="width:300px;" value="'+rs['Data']['Tenancy_Commodity'][i]['Tenancy_Commodity_e']+'" disabled/></label></td>';
            tc += '<td><label class="form-check-label" for="modalCheckBoxTC_c"><input class="tcModal-c" type="text" style="width:300px;" value="'+rs['Data']['Tenancy_Commodity'][i]['Tenancy_Commodity_c']+'" disabled/></label></td>';
            tc += '<td><label class="form-check-label" for="modalNosStall"><input class="nosstallModal" type="number" style="width:75px;" value="'+rs['Data']['Tenancy_Commodity'][i]['nos_stall']+'"  disabled/></label></td>';
            tc += '</tr>';
          }
          if(doAction == 'edit' || doAction == 'add'){
            getOtherTC(rs['Data']['Market_ID']);
          } else {
            tc += '</tbody></table>';
            document.getElementById('modal_tc').innerHTML = tc; 
          }
          // console.log('modalMarketID ' + document.getElementById('modalMarketID').value);
        }
      }
    }

    function getOtherTC(mID){
      mID = mID == '' ? '99999999999999999999999' : mID;
      var url = path + '/atwd/index.php/market/tenancy_commodity/mID/' + mID;
      var body = null;
      req1.open("GET", url, true);
      req1.onreadystatechange = updateOtherTC;
      req1.send(body);
    }

    function updateOtherTC(){
      if (req1.readyState == 4) {
        if (req1.status == 200) {
          // console.log('updateOtherTC');
          var serverData = req1.responseText;
          var rs = JSON.parse(serverData);
          for(item of rs['Data']['tc']){
            tc += '<tr>';
            tc += '<td><input class="form-check-input modal-tc" type="checkbox" id="modalCheckBoxTC" value="'+item['Tenancy_Commodity_ID']+'" ></td>';
            tc += '<td><label class="form-check-label tc-e" for="modalCheckBoxTC_e"><input class="tcModal-e" type="text" style="width:300px;" value="'+item['Tenancy_Commodity_e']+'" disabled/></label></td>';
            tc += '<td><label class="form-check-label tc-c" for="modalCheckBoxTC_c"><input class="tcModal-c" type="text" style="width:200px;" value="'+item['Tenancy_Commodity_c']+'" disabled/></label></td>';
            tc += '<td><label class="form-check-label" for="modalNosStall"><input class="nosstallModal" type="number" style="width:75px;" /></label></td>';
            tc += '</tr>';
          }
          tc += '</tbody></table>';
          
          document.getElementById('modal_tc').innerHTML = tc; 
          for (item of document.getElementsByClassName('form-check-input modal-tc')) {
            item.disabled = '';
          }
          for (item of document.getElementsByClassName('nosstallModal')) {
            item.disabled = '';
          }
        }
      }
    }

    function setConfirmDeleteModal(action, mID) {
      doAction = action;
      document.getElementById('modalName_e').value  = ""; 
      document.getElementById('modalName_c').value  = ""; 
      // document.getElementById('modalRegion_e').value  = ""; 
      document.getElementById('modalRegion_c').value  = ""; 
      var regionHtml = '<option value="" selected></option>';
      for(region of regionList){
        regionHtml += '<option value="'+region['region_e']+'">'+region['region_e']+'</option>'
      }
      document.getElementById("modalRegion_e").innerHTML = regionHtml;
      // document.getElementById('modalDistrict_e').value  = ""; 
      
      var districtHtml = '<option value="" selected></option>';
      for(district of allDistrictList){
        districtHtml += '<option value="'+district['District_e']+'">'+district['District_e']+'</option>'
      }
      document.getElementById("modalDistrict_e").innerHTML = districtHtml;
      document.getElementById('modalDistrict_c').value  = ""; 
      document.getElementById('modalAddress_e').value  = ""; 
      document.getElementById('modalAddress_c').value  = ""; 
      document.getElementById('modalBH_e').value  = ""; 
      document.getElementById('modalBH_c').value  = ""; 
      document.getElementById('modalContact1').value  = ""; 
      document.getElementById('modalContact2').value  = ""; 
      document.getElementById('modalCoordinate').value = ""; 
      if(mID != null){
        getMarketByID(mID);
      }
      if(action == 'add'){
        document.getElementById('modalAddButton').style.display = "block";
        document.getElementById('modalUpdateButton').style.display = "none";
        document.getElementById('modalDeleteButton').style.display = "none";
        document.getElementById('map-container-google-2').style.display = "none";
        tc = '<table class="table table-striped">';
        tc += '<thead>';
        tc += '<th scope="col"></th>';
        tc += '<th scope="col">Tenancy Commodity</th>';
        tc += '<th scope="col"></th>';
        tc += '<th scope="col">Nos Stall</th></thead><tbody>';
        getOtherTC('');
        document.getElementById('confirmDeleteModalLabel').innerHTML='Add';
        document.getElementById('modalName_e').readOnly  = false; 
        document.getElementById('modalName_c').readOnly  = false; 
        document.getElementById('modalRegion_e').disabled  = false; 
        document.getElementById('modalRegion_c').readOnly  = true; 
        document.getElementById('modalDistrict_e').disabled  = true; 
        document.getElementById('modalDistrict_c').readOnly  = true; 
        document.getElementById('modalAddress_e').readOnly   = false; 
        document.getElementById('modalAddress_c').readOnly  = false; 
        document.getElementById('modalBH_e').readOnly   = false; 
        document.getElementById('modalBH_c').readOnly  = false; 
        document.getElementById('modalContact1').readOnly  = false; 
        document.getElementById('modalContact2').readOnly  = false; 
        document.getElementById('modalCoordinate').readOnly = false; 
        document.getElementById('modalName_e').style.backgroundColor  = "white"; 
        document.getElementById('modalName_c').style.backgroundColor  = "white"; 
        document.getElementById('modalRegion_e').style.backgroundColor  = "white"; 
        document.getElementById('modalRegion_c').style.backgroundColor  = "#f8f9fa"; 
        document.getElementById('modalDistrict_e').style.backgroundColor  = "white"; 
        document.getElementById('modalDistrict_c').style.backgroundColor  = "#f8f9fa"; 
        document.getElementById('modalAddress_e').style.backgroundColor  = "white";   
        document.getElementById('modalAddress_c').style.backgroundColor  = "white"; 
        document.getElementById('modalBH_e').style.backgroundColor  = "white";   
        document.getElementById('modalBH_c').style.backgroundColor  = "white"; 
        document.getElementById('modalContact1').style.backgroundColor  = "white"; 
        document.getElementById('modalContact2').style.backgroundColor  = "white"; 
        document.getElementById('modalCoordinate').style.backgroundColor = "white"; 

      }
      if(action == 'detail'){
        document.getElementById('modalAddButton').style.display = "none";
        document.getElementById('modalUpdateButton').style.display = "none";
        document.getElementById('modalDeleteButton').style.display = "block";
        document.getElementById('map-container-google-2').style.display = "block";
        document.getElementById('confirmDeleteModalLabel').innerHTML='Market Detail';
        document.getElementById('modalName_e').readOnly  = true; 
        document.getElementById('modalName_c').readOnly  = true; 
        document.getElementById('modalRegion_e').disabled  = true; 
        // document.getElementById('modalRegion_c').disabled  = true; 
        // document.getElementById('modalDistrict_e').readOnly  = true;  
        document.getElementById('modalDistrict_c').readOnly  = true; 
        document.getElementById('modalDistrict_e').disabled  = true;  
        document.getElementById('modalDistrict_c').disabled  = true; 
        document.getElementById('modalAddress_e').readOnly   = true; 
        document.getElementById('modalAddress_c').readOnly  = true; 
        document.getElementById('modalBH_e').readOnly   = true; 
        document.getElementById('modalBH_c').readOnly  = true; 
        document.getElementById('modalContact1').readOnly  = true; 
        document.getElementById('modalContact2').readOnly  = true; 
        document.getElementById('modalCoordinate').readOnly = true; 
        document.getElementById('modalName_e').style.backgroundColor  = "#f8f9fa"; 
        document.getElementById('modalName_c').style.backgroundColor  = "#f8f9fa"; 
        document.getElementById('modalRegion_e').style.backgroundColor  = "#f8f9fa"; 
        document.getElementById('modalRegion_c').style.backgroundColor  = "#f8f9fa"; 
        document.getElementById('modalDistrict_e').style.backgroundColor  = "#f8f9fa"; 
        document.getElementById('modalDistrict_c').style.backgroundColor  = "#f8f9fa"; 
        document.getElementById('modalAddress_e').style.backgroundColor  = "#f8f9fa";   
        document.getElementById('modalAddress_c').style.backgroundColor  = "#f8f9fa"; 
        document.getElementById('modalBH_e').style.backgroundColor  = "#f8f9fa";   
        document.getElementById('modalBH_c').style.backgroundColor  = "#f8f9fa"; 
        document.getElementById('modalContact1').style.backgroundColor  = "#f8f9fa"; 
        document.getElementById('modalContact2').style.backgroundColor = "#f8f9fa";
        document.getElementById('modalCoordinate').style.backgroundColor = "#f8f9fa";
        for(item of document.getElementsByClassName('form-check-input modal-tc')){
          item.disabled = 'disabled';
        }
        for (item of document.getElementsByClassName('nosstallModal')) {
          item.disabled = 'disabled';
        }
      }
      if(action == 'edit'){
        document.getElementById('modalAddButton').style.display = "none";
        document.getElementById('modalUpdateButton').style.display = "block";
        document.getElementById('modalDeleteButton').style.display = "none";
        document.getElementById('confirmDeleteModalLabel').innerHTML='Edit';
        document.getElementById('map-container-google-2').style.display = "none";
        document.getElementById('modalName_e').readOnly  = false; 
        document.getElementById('modalName_c').readOnly  = false; 
        // document.getElementById('modalRegion_e').readOnly  = true; 
        document.getElementById('modalRegion_c').readOnly  = false; 
        // document.getElementById('modalDistrict_e').readOnly  = true;  
        document.getElementById('modalDistrict_e').disabled  = true; 
        document.getElementById('modalDistrict_c').readOnly  = true; 
        document.getElementById('modalAddress_e').readOnly   = false; 
        document.getElementById('modalAddress_c').readOnly  = false; 
        document.getElementById('modalBH_e').readOnly   = false; 
        document.getElementById('modalBH_c').readOnly  = false; 
        document.getElementById('modalContact1').readOnly  = false; 
        document.getElementById('modalContact2').readOnly  = false; 
        document.getElementById('modalCoordinate').readOnly = false; 
        document.getElementById('modalName_e').style.backgroundColor  = "white"; 
        document.getElementById('modalName_c').style.backgroundColor  = "white"; 
        document.getElementById('modalRegion_e').style.backgroundColor  = "white"; 
        document.getElementById('modalRegion_c').style.backgroundColor  = "#f8f9fa"; 
        document.getElementById('modalDistrict_e').style.backgroundColor  = "white"; 
        document.getElementById('modalDistrict_c').style.backgroundColor  = "#f8f9fa"; 
        document.getElementById('modalAddress_e').style.backgroundColor  = "white";   
        document.getElementById('modalAddress_c').style.backgroundColor  = "white"; 
        document.getElementById('modalBH_e').style.backgroundColor  = "white";   
        document.getElementById('modalBH_c').style.backgroundColor  = "white"; 
        document.getElementById('modalContact1').style.backgroundColor  = "white"; 
        document.getElementById('modalContact2').style.backgroundColor  = "white"; 
        document.getElementById('modalCoordinate').style.backgroundColor = "white"; 
      }
    }


    function loadRegion_c(){
      var region_e = document.getElementById('modalRegion_e').value;
      for(region of regionList){
        if(region_e == region['region_e']){
          document.getElementById("modalRegion_c").value = region['region_c'];
        }
      }
    }
    
    function requestModalDistrictField(){
      document.getElementById('modalDistrict_e').disabled  = false; 
      document.getElementById("modalDistrict_c").value = '';
      if(document.getElementById('modalRegion_e').value == ''){
        document.getElementById('modalRegion_c').value = '';
      }
      var url = path + '/atwd/index.php/market/field/district/' + document.getElementById('modalRegion_e').value;
      var body = null;
      requestPageLoad.open("GET", url, true);
      // console.log('requestModalDistrictField');
      // console.log(url);
      requestPageLoad.onreadystatechange = loadModalDistrictFields;
      requestPageLoad.send(body);
    }

    function loadModalDistrictFields(){
    if (requestPageLoad.readyState == 4) {
        if (requestPageLoad.status == 200) {
            var serverData = requestPageLoad.responseText;
            var resultArray = JSON.parse(serverData);
            var htmlModalDistrictLoad = '<option value="" selected></option>';
            for(district of resultArray['Data']['district']){
              htmlModalDistrictLoad += '<option value="'+district['District_e']+'">'+district['District_e']+'</option>'
            }
            document.getElementById("modalDistrict_e").innerHTML = htmlModalDistrictLoad;
        }
    }
    }

    function loadDistrict_c(){
      var district_e = document.getElementById('modalDistrict_e').value;
      for(district of allDistrictList){
        if(district_e == district['District_e']){
          document.getElementById("modalDistrict_c").value = district['District_c'];
        }
      }
    }

    function clearSearch(){
      loadDistrictFields();
      for(item of document.getElementsByClassName('form-check-input tc')){
        item.checked = '';
      }
    }

    var reqCUD = new XMLHttpRequest();

    function goDelete(){
      var url = path + '/atwd/index.php/market';
      var mID = document.getElementById("modalMarketID").value;
      // console.log(mID);
      var body = {
        Market_ID: mID
      };
      // console.log(body);
      reqCUD.open("DELETE", url, true);
      reqCUD.setRequestHeader('Content-Type', 'application/json;charset=UTF-8')
      reqCUD.onreadystatechange = reloadPage;
      
      reqCUD.send(JSON.stringify(body));
    }
    
    function goAdd() {
      var url = path + '/atwd/index.php/market';


      var Market_Name_e = document.getElementById("modalName_e").value;
      var Market_Name_c = document.getElementById("modalName_c").value;
      var Region_e = document.getElementById("modalRegion_e").value;
      var Region_c = document.getElementById("modalRegion_c").value;
      var District_e = document.getElementById("modalDistrict_e").value;
      var District_c = document.getElementById("modalDistrict_c").value;
      var Address_e = document.getElementById("modalAddress_e").value;
      var Address_c = document.getElementById("modalAddress_c").value;
      var Bussiness_Hour_e = document.getElementById("modalBH_e").value;
      var Bussiness_Hour_c = document.getElementById("modalBH_c").value;
      var Coordinate = document.getElementById("modalCoordinate").value;
      var Contact_1 = document.getElementById("modalContact1").value;
      var Contact_2 = document.getElementById("modalContact2").value;
      var isActive = true;
      var Tenancy_Commodity = new Array()
      for(var i=0; i< document.getElementsByClassName("form-check-input tc").length; i++){
        var tcItem;
        if(document.getElementsByClassName("form-check-input modal-tc")[i].checked == true){
          tcItem = {
            Tenancy_Commodity_e: document.getElementsByClassName("tcModal-e")[i].value,
            Tenancy_Commodity_c: document.getElementsByClassName("tcModal-c")[i].value,
            nos_stall: document.getElementsByClassName("nosstallModal")[i].value
          };
          Tenancy_Commodity.push(tcItem);
          // tcItem['Tenancy_Commodity_e'] = document.getElementsByClassName("tcModal-e")[i].value;
          // tcItem['Tenancy_Commodity_c'] = document.getElementsByClassName("tcModal-c")[i].value;
          // tcItem['nos_stall'] = document.getElementsByClassName("nosstallModal")[i].value;
        }
      }

      var body = {
        Market_Name_e: Market_Name_e,
        Market_Name_c: Market_Name_c,
        Region_e: Region_e,
        Region_c: Region_c,
        District_e: District_e,
        District_c: District_c,
        Address_e: Address_e,
        Address_c: Address_c,
        Bussiness_Hour_e: Bussiness_Hour_e,
        Bussiness_Hour_c: Bussiness_Hour_c,
        Coordinate: Coordinate,
        Contact_1: Contact_1,
        Contact_2: Contact_2,
        isActive: isActive,
        Tenancy_Commodity: Tenancy_Commodity
      };
      // console.log(body);

      reqCUD.open("POST", url, true);
      reqCUD.setRequestHeader('Content-Type', 'application/json;charset=UTF-8')
      reqCUD.onreadystatechange = reloadPage;
      
      reqCUD.send(JSON.stringify(body));
    }
    
    function goUpdate() {
      var url = path + '/atwd/index.php/market';


      var Market_ID = document.getElementById("modalMarketID").value;
      var Market_Name_e = document.getElementById("modalName_e").value;
      var Market_Name_c = document.getElementById("modalName_c").value;
      var Region_e = document.getElementById("modalRegion_e").value;
      var District_e = document.getElementById("modalDistrict_e").value;
      var Address_e = document.getElementById("modalAddress_e").value;
      var Address_c = document.getElementById("modalAddress_c").value;
      var Bussiness_Hour_e = document.getElementById("modalBH_e").value;
      var Bussiness_Hour_c = document.getElementById("modalBH_c").value;
      var Coordinate = document.getElementById("modalCoordinate").value;
      var Contact_1 = document.getElementById("modalContact1").value;
      var Contact_2 = document.getElementById("modalContact2").value;
      var isActive = true;
      console.log(Market_ID);
      var Tenancy_Commodity = new Array()
      for(var i=0; i< document.getElementsByClassName("form-check-input tc").length; i++){
        var tcItem;
        if(document.getElementsByClassName("form-check-input modal-tc")[i].checked == true){
          tcItem = {
            Tenancy_Commodity_e: document.getElementsByClassName("tcModal-e")[i].value,
            Tenancy_Commodity_c: document.getElementsByClassName("tcModal-c")[i].value,
            nos_stall: document.getElementsByClassName("nosstallModal")[i].value
          };
          Tenancy_Commodity.push(tcItem);
          // tcItem['Tenancy_Commodity_e'] = document.getElementsByClassName("tcModal-e")[i].value;
          // tcItem['Tenancy_Commodity_c'] = document.getElementsByClassName("tcModal-c")[i].value;
          // tcItem['nos_stall'] = document.getElementsByClassName("nosstallModal")[i].value;
        }
      }

      var body = {
        Market_ID: Market_ID,
        Market_Name_e: Market_Name_e,
        Market_Name_c: Market_Name_c,
        Region_e: Region_e,
        District_e: District_e,
        Address_e: Address_e,
        Address_c: Address_c,
        Bussiness_Hour_e: Bussiness_Hour_e,
        Bussiness_Hour_c: Bussiness_Hour_c,
        Coordinate: Coordinate,
        Contact_1: Contact_1,
        Contact_2: Contact_2,
        isActive: isActive,
        Tenancy_Commodity: Tenancy_Commodity
      };
      console.log(JSON.stringify(body));

      reqCUD.open("PUT", url, true);
      reqCUD.setRequestHeader('Content-Type', 'application/json;charset=UTF-8')
      reqCUD.onreadystatechange = reloadPage;
      
      reqCUD.send(JSON.stringify(body));
    }

    function reloadPage(){
      if (reqCUD.readyState == 4) {
        if (reqCUD.status == 200) {
          var serverData = reqCUD.responseText;
          var rs = JSON.parse(serverData);
          console.log(rs);
          if (rs['Code'] == 200) {
            marketList('left');
            alert(rs['Message']);
            document.getElementById('btnModalCancel').click();
          } else {
            alert('Error: '+rs['Message']);
          }
        }
      }
    }

    var mainPage = false; // true = market listing, false = log listing
    
    function clickChangePage(){
      // console.log('clickChangePage');
      listLog();
      changeMainPage();
      if(mainPage){ // market listing
        mainPage = false;
      } else { // log listing
        mainPage = true;
      }
    }

    function changeMainPage(){
      if(mainPage){ // market listing
        document.getElementById('logListingPage').style.display = 'none';
        document.getElementById('marketListingPage').style.display = 'block';
      } else { // log listing
        document.getElementById('logListingPage').style.display = 'block';
        document.getElementById('marketListingPage').style.display = 'none';
      }
    }

    var reqLog = new XMLHttpRequest();

    function listLog(){
      var url = path + '/atwd/index.php/log';
      var body = null;
      reqLog.open("GET", url, true);
      // console.log('listLog');
      // console.log(url);
      reqLog.onreadystatechange = loadLog;
      reqLog.send(body);
    }

    function loadLog(){
      if (reqLog.readyState == 4) {
        if (reqLog.status == 200) {
          var serverData = reqLog.responseText;
          var rs = JSON.parse(serverData);
          if(rs['Code'] == 200){
            var logHTML = '';
            var idx = 1;
            for(item of rs['Data']){
              logHTML += '<tr>';
              logHTML += '<td>'+idx+'</td>';
              logHTML += '<td>'+item['logDesc']+'</td>';
              logHTML += '<td>'+item['createDatetime']+'</td>';
              logHTML += '</tr>';
              idx++;
            }
            document.getElementById('LogBody').innerHTML = logHTML;
          } else {
            alert('Error: '+rs['Message']);
            changeMainPage();
          }
        }
      }
    }

    var reqXML = new XMLHttpRequest();

    function clickImport(){
      var url = path + '/atwd/index.php/market/xml_import';
      var body = null;
      reqXML.open("GET", url, true);
      // console.log('clickImport');
      // console.log(url);
      reqXML.onreadystatechange = importXML;
      reqXML.send(body);
    }

    function importXML(){
      if (reqXML.readyState == 4) {
        if (reqXML.status == 200) {
          var serverData = reqXML.responseText;
          var rs = JSON.parse(serverData);
          if(rs['Code'] == 200){
            alert('Market import success');
            pageLoad();
            marketList('');
          } else {
            alert('Error: '+rs['Message']);
          }
        }
      }
    }

  </script>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/apexcharts/apexcharts.min.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/chart.js/chart.min.js"></script>
  <script src="assets/vendor/echarts/echarts.min.js"></script>
  <script src="assets/vendor/quill/quill.min.js"></script>
  <script src="assets/vendor/simple-datatables/simple-datatables.js"></script>
  <script src="assets/vendor/tinymce/tinymce.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>
</body>

</html>